<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D Birthday Scene</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            background: #000;
        }
        canvas {
            display: block;
        }
        .controls {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(255, 255, 255, 0.9);
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
            z-index: 100;
        }
        .controls h3 {
            margin: 0 0 10px 0;
            color: #333;
        }
        .photo-upload {
            margin: 5px 0;
        }
        .photo-upload label {
            display: block;
            margin-bottom: 5px;
            color: #555;
            font-size: 14px;
        }
        .photo-upload input[type="file"] {
            display: none;
        }
        .photo-upload .upload-btn {
            background: #ff69b4;
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            display: inline-block;
            font-size: 12px;
            transition: background 0.3s;
        }
        .photo-upload .upload-btn:hover {
            background: #ff1493;
        }
        .instructions {
            margin-top: 10px;
            font-size: 12px;
            color: #666;
        }
    </style>
</head>
<body>
    <div class="controls">
        <h3>üéÇ Birthday Scene Controls</h3>
        <div class="photo-upload">
            <label>Photo Frame 1 (Left):</label>
            <input type="file" id="photo1" accept="image/*" onchange="updatePhotoFrame(0, this)">
            <label for="photo1" class="upload-btn">Choose Image</label>
        </div>
        <div class="photo-upload">
            <label>Photo Frame 2 (Right):</label>
            <input type="file" id="photo2" accept="image/*" onchange="updatePhotoFrame(1, this)">
            <label for="photo2" class="upload-btn">Choose Image</label>
        </div>
        <div class="photo-upload">
            <label>üìç Real Location Background:</label>
            <input type="file" id="locationImage" accept="image/*" onchange="updateLocationBackground(this)">
            <label for="locationImage" class="upload-btn">Upload Jungfrusgata 414, Handen</label>
        </div>
        <div class="photo-upload">
            <label>üó∫Ô∏è Get Real Location:</label>
            <button class="upload-btn" onclick="openGoogleMaps()">Open Google Maps</button>
        </div>
        <div class="instructions">
            üñ±Ô∏è Left click + drag to rotate<br>
            üñ±Ô∏è Right click + drag to pan<br>
            üñ±Ô∏è Scroll to zoom in/out<br>
            üìç Upload a real photo of Jungfrusgata 414, Handen
        </div>
    </div>
    
    <!-- Sketchfab preview of romantic photo frame model -->
    <div class="sketchfab-embed-wrapper" style="position: absolute; left: 20px; bottom: 20px; width: 320px; height: 240px; border-radius: 10px; overflow: hidden; box-shadow: 0 4px 12px rgba(0,0,0,0.4); background: #000;">
        <iframe title="Photo frame &quot;The heart's memories&quot;." frameborder="0" allowfullscreen mozallowfullscreen="true" webkitallowfullscreen="true" allow="autoplay; fullscreen; xr-spatial-tracking" xr-spatial-tracking execution-while-out-of-viewport execution-while-not-rendered web-share src="https://sketchfab.com/models/398ff3de25db4350bee758c9201ca86e/embed" style="width: 100%; height: 100%;"></iframe>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/OBJLoader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/FBXLoader.js"></script>
    <script>
        let scene, camera, renderer, controls;
        let photoFrames = [];
        let locationBackdrop;
        
        function init() {
            scene = new THREE.Scene();
            
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.set(0, 15, 30);
            camera.lookAt(0, 5, 0);
            
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.shadowMap.enabled = true;
            renderer.shadowMap.type = THREE.PCFSoftShadowMap;
            document.body.appendChild(renderer.domElement);
            
            // Add orbit controls
            controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            controls.dampingFactor = 0.05;
            controls.minDistance = 10;
            controls.maxDistance = 50;
            controls.maxPolarAngle = Math.PI / 2;
            
            createLighting();
            createTablecloth();
            createSmallTable();
            createRomanticDecor();
            createPhotoFrames();
            createBirthdayCard();
            createChairs();
            createPeople();
            createCityBackground();
            
            animate();
        }
        
        function createLighting() {
            // Ambient light
            const ambientLight = new THREE.AmbientLight(0x404040, 0.3);
            scene.add(ambientLight);
            
            // Main warm light from above
            const mainLight = new THREE.DirectionalLight(0xffd4a3, 1);
            mainLight.position.set(5, 20, 5);
            mainLight.castShadow = true;
            mainLight.shadow.mapSize.width = 2048;
            mainLight.shadow.mapSize.height = 2048;
            scene.add(mainLight);
            
            // City lights glow
            const cityLight = new THREE.DirectionalLight(0x4a90e2, 0.5);
            cityLight.position.set(-10, 10, -20);
            scene.add(cityLight);
        }
        
        function createTablecloth() {
            const geometry = new THREE.PlaneGeometry(60, 40);
            const canvas = document.createElement('canvas');
            canvas.width = 512;
            canvas.height = 512;
            const context = canvas.getContext('2d');
            
            // Create checkered pattern
            const squareSize = 32;
            for (let i = 0; i < 16; i++) {
                for (let j = 0; j < 16; j++) {
                    context.fillStyle = (i + j) % 2 === 0 ? '#ffffff' : '#ff69b4';
                    context.fillRect(i * squareSize, j * squareSize, squareSize, squareSize);
                }
            }
            
            const texture = new THREE.CanvasTexture(canvas);
            const material = new THREE.MeshLambertMaterial({ map: texture });
            const tablecloth = new THREE.Mesh(geometry, material);
            tablecloth.rotation.x = -Math.PI / 2;
            tablecloth.position.y = -1;
            tablecloth.receiveShadow = true;
            scene.add(tablecloth);
        }
        
        function createSmallTable() {
            const tableGroup = new THREE.Group();
            
            // Small table top
            const tableTopGeometry = new THREE.BoxGeometry(12, 0.5, 8);
            const tableTopMaterial = new THREE.MeshLambertMaterial({ color: 0x8b4513 });
            const tableTop = new THREE.Mesh(tableTopGeometry, tableTopMaterial);
            tableTop.position.y = 2.5;
            tableTop.castShadow = true;
            tableGroup.add(tableTop);
            
            // Table legs
            const legGeometry = new THREE.CylinderGeometry(0.3, 0.3, 3);
            const legMaterial = new THREE.MeshLambertMaterial({ color: 0x654321 });
            
            const legPositions = [
                { x: -5, z: -3 },
                { x: 5, z: -3 },
                { x: -5, z: 3 },
                { x: 5, z: 3 }
            ];
            
            legPositions.forEach(pos => {
                const leg = new THREE.Mesh(legGeometry, legMaterial);
                // Center legs a bit lower so their bottoms touch the floor at y = -1
                leg.position.set(pos.x, 0.5, pos.z);
                leg.castShadow = true;
                tableGroup.add(leg);
            });
            
            scene.add(tableGroup);
        }
        
        function createRomanticDecor() {
            // Central candle
            const candleMaterial = new THREE.MeshLambertMaterial({ color: 0xfff5e1 });
            const candleGeometry = new THREE.CylinderGeometry(0.3, 0.3, 1.2, 12);
            const candle = new THREE.Mesh(candleGeometry, candleMaterial);
            candle.position.set(0, 3.1, 0);
            candle.castShadow = true;
            scene.add(candle);

            // Candle flame
            const flameGeometry = new THREE.SphereGeometry(0.25, 8, 8);
            const flameMaterial = new THREE.MeshBasicMaterial({ color: 0xffaa33 });
            const flame = new THREE.Mesh(flameGeometry, flameMaterial);
            flame.position.set(0, 3.9, 0);
            scene.add(flame);

            // Small flower vase
            const vaseGeometry = new THREE.CylinderGeometry(0.25, 0.3, 0.8, 12);
            const vaseMaterial = new THREE.MeshLambertMaterial({ color: 0xffffff });
            const vase = new THREE.Mesh(vaseGeometry, vaseMaterial);
            vase.position.set(0, 3, -1.5);
            vase.castShadow = true;
            scene.add(vase);

            const flowerGeometry = new THREE.SphereGeometry(0.3, 8, 8);
            const flowerMaterial = new THREE.MeshLambertMaterial({ color: 0xff69b4 });
            const flower = new THREE.Mesh(flowerGeometry, flowerMaterial);
            flower.position.set(0, 3.6, -1.5);
            flower.castShadow = true;
            scene.add(flower);
        }
        
        function createPhotoFrames() {
            const photoMaterial = new THREE.MeshBasicMaterial({ color: 0x87ceeb });
            const positions = [
                { x: -4, z: 1.2, rotationY: Math.PI / 16 },   // Left
                { x: 4, z: 1.2, rotationY: -Math.PI / 16 }    // Right
            ];

            // Fallback: simple rectangular frames if FBX can't be loaded
            function createSimpleFrames() {
                const frameMaterial = new THREE.MeshLambertMaterial({ color: 0x8b4513 });
                positions.forEach((pos, index) => {
                    const frameGroup = new THREE.Group();

                    const frameGeometry = new THREE.BoxGeometry(2.2, 2.6, 0.25);
                    const frame = new THREE.Mesh(frameGeometry, frameMaterial);
                    frame.castShadow = true;
                    frameGroup.add(frame);

                    const photoGeometry = new THREE.PlaneGeometry(1.8, 2.2);
                    const photo = new THREE.Mesh(photoGeometry, photoMaterial.clone());
                    photo.position.z = 0.14;
                    photo.userData = { frameIndex: index };
                    frameGroup.add(photo);

                    frameGroup.position.set(pos.x, 3.3, pos.z);
                    frameGroup.rotation.y = pos.rotationY;

                    photoFrames.push(frameGroup);
                    scene.add(frameGroup);
                });
            }

            if (typeof THREE.FBXLoader === 'undefined') {
                createSimpleFrames();
                return;
            }

            const loader = new THREE.FBXLoader();
            loader.load(
                'PhotoFrame.fbx',
                function(object) {
                    object.traverse(function(child) {
                        if (child.isMesh) {
                            child.castShadow = true;
                            child.receiveShadow = true;
                        }
                    });

                    const baseFrame = new THREE.Group();
                    baseFrame.add(object);
                    // Adjust scale/orientation if needed
                    baseFrame.scale.set(0.01, 0.01, 0.01);

                    positions.forEach((pos, index) => {
                        const frameGroup = baseFrame.clone(true);

                        const photoGeometry = new THREE.PlaneGeometry(1.4, 1.4);
                        const photo = new THREE.Mesh(photoGeometry, photoMaterial.clone());
                        photo.position.set(0, 1, 0.2);
                        photo.userData = { frameIndex: index };
                        frameGroup.add(photo);

                        frameGroup.position.set(pos.x, 3.2, pos.z);
                        frameGroup.rotation.y = pos.rotationY;

                        photoFrames.push(frameGroup);
                        scene.add(frameGroup);
                    });
                },
                undefined,
                function() {
                    createSimpleFrames();
                }
            );
        }
        
        function updatePhotoFrame(frameIndex, input) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    const textureLoader = new THREE.TextureLoader();
                    textureLoader.load(e.target.result, function(texture) {
                        // Find the photo mesh in the specified frame
                        const frameGroup = photoFrames[frameIndex];
                        const photoMesh = frameGroup.children.find(child => child.userData.frameIndex === frameIndex);
                        
                        if (photoMesh) {
                            photoMesh.material.map = texture;
                            photoMesh.material.needsUpdate = true;
                        }
                    });
                };
                
                reader.readAsDataURL(input.files[0]);
            }
        }
        
        function createChairs() {
            const chairMaterial = new THREE.MeshLambertMaterial({ color: 0x8b4513 });
            const seatMaterial = new THREE.MeshLambertMaterial({ color: 0xa0522d });
            
            // Chair 1 - Left side
            const chair1 = new THREE.Group();
            
            // Seat
            const seat1 = new THREE.Mesh(
                new THREE.BoxGeometry(4, 0.5, 4),
                seatMaterial
            );
            seat1.position.set(0, 1, 0);
            seat1.castShadow = true;
            chair1.add(seat1);
            
            // Backrest
            const backrest1 = new THREE.Mesh(
                new THREE.BoxGeometry(4, 4, 0.5),
                chairMaterial
            );
            backrest1.position.set(0, 3, -1.75);
            backrest1.castShadow = true;
            chair1.add(backrest1);
            
            // Legs
            const legGeometry = new THREE.CylinderGeometry(0.2, 0.2, 2);
            const legPositions = [
                { x: -1.5, z: -1.5 },
                { x: 1.5, z: -1.5 },
                { x: -1.5, z: 1.5 },
                { x: 1.5, z: 1.5 }
            ];
            
            legPositions.forEach(pos => {
                const leg = new THREE.Mesh(legGeometry, chairMaterial);
                // Center legs so bottoms are at y = -1 (floor) and tops overlap the seat
                leg.position.set(pos.x, 0, pos.z);
                leg.castShadow = true;
                chair1.add(leg);
            });
            
            chair1.position.set(-12, 0, 0);
            chair1.rotation.y = Math.PI / 2;
            scene.add(chair1);
            
            // Chair 2 - Right side
            const chair2 = new THREE.Group();
            
            // Seat
            const seat2 = new THREE.Mesh(
                new THREE.BoxGeometry(4, 0.5, 4),
                seatMaterial
            );
            seat2.position.set(0, 1, 0);
            seat2.castShadow = true;
            chair2.add(seat2);
            
            // Backrest
            const backrest2 = new THREE.Mesh(
                new THREE.BoxGeometry(4, 4, 0.5),
                chairMaterial
            );
            backrest2.position.set(0, 3, -1.75);
            backrest2.castShadow = true;
            chair2.add(backrest2);
            
            // Legs
            legPositions.forEach(pos => {
                const leg = new THREE.Mesh(legGeometry, chairMaterial);
                // Center legs so bottoms are at y = -1 (floor) and tops overlap the seat
                leg.position.set(pos.x, 0, pos.z);
                leg.castShadow = true;
                chair2.add(leg);
            });
            
            chair2.position.set(12, 0, 0);
            chair2.rotation.y = -Math.PI / 2;
            scene.add(chair2);
        }
        
        function createPeople() {
            // Person 1 - Sitting in left chair
            const person1 = new THREE.Group();
            
            // Body
            const body1 = new THREE.Mesh(
                new THREE.CylinderGeometry(1.5, 1.8, 4, 8),
                new THREE.MeshLambertMaterial({ color: 0x4169e1 }) // Blue shirt
            );
            body1.position.set(0, 5, 0);
            person1.add(body1);
            
            // Head
            const head1 = new THREE.Mesh(
                new THREE.SphereGeometry(1, 8, 8),
                new THREE.MeshLambertMaterial({ color: 0xfdbcb4 }) // Skin tone
            );
            head1.position.set(0, 7.5, 0);
            person1.add(head1);
            
            // Arms positioned toward table
            const armGeometry = new THREE.CylinderGeometry(0.3, 0.3, 3);
            const leftArm1 = new THREE.Mesh(armGeometry, new THREE.MeshLambertMaterial({ color: 0xfdbcb4 }));
            leftArm1.position.set(-1.5, 5.5, 1);
            leftArm1.rotation.x = -Math.PI / 4;
            person1.add(leftArm1);
            
            const rightArm1 = new THREE.Mesh(armGeometry, new THREE.MeshLambertMaterial({ color: 0xfdbcb4 }));
            rightArm1.position.set(1.5, 5.5, 1);
            rightArm1.rotation.x = -Math.PI / 4;
            person1.add(rightArm1);
            
            // Position person 1 in left chair (sit on chair)
            person1.position.set(-12, -2, 0);
            person1.rotation.y = Math.PI / 2;
            scene.add(person1);
            
            // Person 2 - Sitting in right chair
            const person2 = new THREE.Group();
            
            // Body
            const body2 = new THREE.Mesh(
                new THREE.CylinderGeometry(1.5, 1.8, 4, 8),
                new THREE.MeshLambertMaterial({ color: 0xff69b4 }) // Pink shirt
            );
            body2.position.set(0, 5, 0);
            person2.add(body2);
            
            // Head
            const head2 = new THREE.Mesh(
                new THREE.SphereGeometry(1, 8, 8),
                new THREE.MeshLambertMaterial({ color: 0xfdbcb4 }) // Skin tone
            );
            head2.position.set(0, 7.5, 0);
            person2.add(head2);
            
            // Hair
            const hair2 = new THREE.Mesh(
                new THREE.SphereGeometry(1.1, 8, 8),
                new THREE.MeshLambertMaterial({ color: 0x8b4513 }) // Brown hair
            );
            hair2.position.set(0, 8.3, 0);
            hair2.scale.y = 0.6;
            person2.add(hair2);
            
            // Arms positioned toward table
            const leftArm2 = new THREE.Mesh(armGeometry, new THREE.MeshLambertMaterial({ color: 0xfdbcb4 }));
            leftArm2.position.set(-1.5, 5.5, 1);
            leftArm2.rotation.x = -Math.PI / 4;
            person2.add(leftArm2);
            
            const rightArm2 = new THREE.Mesh(armGeometry, new THREE.MeshLambertMaterial({ color: 0xfdbcb4 }));
            rightArm2.position.set(1.5, 5.5, 1);
            rightArm2.rotation.x = -Math.PI / 4;
            person2.add(rightArm2);
            
            // Position person 2 in right chair (sit on chair)
            person2.position.set(12, -2, 0);
            person2.rotation.y = -Math.PI / 2;
            scene.add(person2);
            
            // No plates: leave space in front of each person for a clean romantic table
        }
        
        function createBirthdayCard() {
            const cardGroup = new THREE.Group();
            
            // Card
            const cardGeometry = new THREE.BoxGeometry(3, 2, 0.1);
            const cardMaterial = new THREE.MeshLambertMaterial({ color: 0xffffff });
            const card = new THREE.Mesh(cardGeometry, cardMaterial);
            card.castShadow = true;
            cardGroup.add(card);
            
            // Add "HAPPY BIRTHDAY" text (simplified as colored rectangle)
            const textGeometry = new THREE.PlaneGeometry(2.5, 0.5);
            const textMaterial = new THREE.MeshBasicMaterial({ color: 0xff69b4 });
            const text = new THREE.Mesh(textGeometry, textMaterial);
            text.position.set(0, 0.3, 0.06);
            cardGroup.add(text);
            
            cardGroup.position.set(0, 3, 0);
            scene.add(cardGroup);
        }
        
        function createCityBackground() {
            // Create a simple black backdrop
            const backdropGeometry = new THREE.SphereGeometry(200, 32, 32);
            const backdropMaterial = new THREE.MeshBasicMaterial({ 
                color: 0x000000,
                side: THREE.BackSide
            });
            const backdrop = new THREE.Mesh(backdropGeometry, backdropMaterial);
            scene.add(backdrop);
            locationBackdrop = backdrop; // Store reference for updates
        }
        
        function openGoogleMaps() {
            // Open Google Maps for Jungfrusgata 414, Handen
            window.open('https://www.google.com/maps/place/Jungfrusgata+414,+136+45+Handen/@59.1496,18.1567,17z', '_blank');
        }
        
        function updateLocationBackground(input) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    const textureLoader = new THREE.TextureLoader();
                    textureLoader.load(e.target.result, function(texture) {
                        if (locationBackdrop) {
                            locationBackdrop.material.map = texture;
                            locationBackdrop.material.needsUpdate = true;
                        }
                    });
                };
                
                reader.readAsDataURL(input.files[0]);
            }
        }
        
        function animate() {
            requestAnimationFrame(animate);
            
            // Update controls
            controls.update();
            
            renderer.render(scene, camera);
        }
        
        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }
        
        window.addEventListener('resize', onWindowResize);
        
        init();
    </script>
</body>
</html>
